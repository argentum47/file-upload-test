#!/usr/bin/env node

/**
 * Module dependencies.
 */

var process = require('process');
var child_process = require('child_process');

var ports = ['3000', '3001', '3002', '3003'];

ports.forEach(function(port) {
  var oldSpawn = child_process.spawn;

  function newSpawn() {
    console.log('my spawn');
    console.log(arguments[0]);
    return oldSpawn.apply(this, arguments);
  };

  child_process.spawn = newSpawn;

  var child = child_process.spawn('node', ['./bin/server'],  {env: Object.assign({ PORT: port}, process.env) })
  child.stdout.on('data', function(d) {
    process.stdout.write('data: ' + d + '\n');
  });

  child.on('exit', function() {
    process.stdout.write('child exit with code', arguments);
  });
});
